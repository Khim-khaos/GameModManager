# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å 429 Too Many Requests

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–ª–æ –æ—à–∏–±–∫–∏ `429 Too Many Requests` –æ—Ç Steam –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–¥–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
- –ü–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–¥–æ–≤
- –ú–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Steam

## –ö–æ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ 429 –æ—à–∏–±–æ–∫** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–æ –∑–∞–ø—Ä–æ—Å—ã
3. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤** - 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫** - –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –Ω–µ –±—ã–ª–æ —Ä–∞–∑—É–º–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è

## –†–µ—à–µ–Ω–∏–µ

### 1. üîß Rate Limiting –≤ SteamWorkshopService

```python
def _wait_for_rate_limit(self):
    """–û–∂–∏–¥–∞–Ω–∏–µ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤"""
    current_time = time.time()
    time_since_last = current_time - self.last_request_time
    
    if time_since_last < self.min_request_interval:
        sleep_time = self.min_request_interval - time_since_last
        time.sleep(sleep_time)
    
    self.last_request_time = time.time()
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: **1 —Å–µ–∫—É–Ω–¥–∞** –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–ø—ã—Ç–æ–∫: **3**
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ 429: **2^attempt + random(0, 1)** —Å–µ–∫—É–Ω–¥

### 2. üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ 429

```python
def _make_request_with_retry(self, url: str, timeout: int = 15):
    for attempt in range(self.max_retries):
        response = self.session.get(url, timeout=timeout)
        
        if response.status_code == 429:
            wait_time = min(60, (2 ** attempt) + random.uniform(0, 1))
            logger.warning(f"429 –æ—à–∏–±–∫–∞, –ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}, –æ–∂–∏–¥–∞–Ω–∏–µ {wait_time:.1f}—Å")
            time.sleep(wait_time)
            continue
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤:**
- 1-—è –ø–æ–ø—ã—Ç–∫–∞: 1-2 —Å–µ–∫—É–Ω–¥—ã –æ–∂–∏–¥–∞–Ω–∏—è
- 2-—è –ø–æ–ø—ã—Ç–∫–∞: 2-3 —Å–µ–∫—É–Ω–¥—ã –æ–∂–∏–¥–∞–Ω–∏—è  
- 3-—è –ø–æ–ø—ã—Ç–∫–∞: 4-5 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ: 60 —Å–µ–∫—É–Ω–¥

### 3. ‚ö° –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤

```python
# –ë—ã–ª–æ: 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
self.names_semaphore = threading.Semaphore(5)

# –°—Ç–∞–ª–æ: 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞
self.names_semaphore = threading.Semaphore(2)
```

### 4. ‚è±Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

```python
def _load_single_mod_name_task(self, mod: Mod):
    # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
    time.sleep(0.5)
    
    details = self.steam_workshop_service.get_mod_details(mod.mod_id)
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
10:30:45 | WARNING | [SteamWorkshopService/Details] –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: 429 Client Error: Too Many Requests
10:30:45 | WARNING | [ModsTab/ListName/Task] [570767699] –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
10:45:12 | DEBUG | [SteamWorkshopService] –û–∂–∏–¥–∞–Ω–∏–µ 0.85—Å –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
10:45:13 | INFO | [SteamWorkshopService/Details] –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞ 570767699
10:45:14 | DEBUG | [SteamWorkshopService] –û–∂–∏–¥–∞–Ω–∏–µ 0.92—Å –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
- Graceful degradation –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é

### ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** 
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –º–æ–¥–æ–≤ –±–µ–∑ –∫—ç—à–∞
- –£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ 429 –æ—à–∏–±–æ–∫
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã Steam
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ):
```python
min_request_interval = 1.0  # 1 —Å–µ–∫—É–Ω–¥–∞
max_retries = 3
semaphore_threads = 2
task_delay = 0.5
```

### –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ):
```python
min_request_interval = 0.5  # 0.5 —Å–µ–∫—É–Ω–¥—ã
max_retries = 2
semaphore_threads = 3
task_delay = 0.2
```

### –û—Å—Ç–æ—Ä–æ–∂–Ω—ã–µ (–µ—Å–ª–∏ —á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É—é—Ç):
```python
min_request_interval = 2.0  # 2 —Å–µ–∫—É–Ω–¥—ã
max_retries = 5
semaphore_threads = 1
task_delay = 1.0
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- `[SteamWorkshopService] –û–∂–∏–¥–∞–Ω–∏–µ X.XX—Å –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤`
- `[SteamWorkshopService] 429 –æ—à–∏–±–∫–∞, –ø–æ–ø—ã—Ç–∫–∞ N/X, –æ–∂–∏–¥–∞–Ω–∏–µ X.X—Å`
- `[ModsTab/ListNames] –ù—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å N –º–æ–¥–æ–≤ –∏–∑ X`

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- **Hit rate**: % –º–æ–¥–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑ –∫—ç—à–∞
- **Retry rate**: % –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–≤—à–∏—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤
- **Average load time**: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–∞

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ rate limiting** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏** - –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∞–∂–Ω—ã—Ö –º–æ–¥–æ–≤ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
3. **Batch –∑–∞–ø—Ä–æ—Å—ã** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ:
```python
service = SteamWorkshopService()
details = service.get_mod_details(mod_id)  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å rate limiting
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ:
```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
service.min_request_interval = 2.0
service.max_retries = 5

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
service.invalidate_cache(mod_id)
```

## –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ 429 –æ—à–∏–±–∫–∞–º –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –º–æ–¥–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤ Steam.
